# Kubernetes
## 쿠버네티스란?
- 한단어로 표현하면 "관리자"
- 도커파일 하나에 모든 서비스를 집어넣고 구동시킨다면 관리자가 필요 없겠지만 그럴 이유와 필요는 없기에 관리자가 필요.
- 각 컨테이너의서비스를 독립적으로 보장해주어야하기 떄문에 컨테이너를 여럿 만들게 되었고, 그 컨테이너를 고나리해주어야할 필요성이 생김.
- 그래서 사용한다.
### 어떠한 관리 기능이 있는가?
1. 각 서비스에 대한 고유한 ip 주소 부여
2. 업데이트중에서 서비스를 사용할 수 있도록 스케줄링
3. 오류가 생긴 컨테이너는 자동으로 재시작
4. 실행중에 문제가 발생하면 쿠버네티스는 자동적으로 변경사항을 롤백
...

## 파드?
- 파드는 하나 이상의 컨테이너의 그룹입니다.
- 컨테이너끼리 저장소의 리소스, 임시 네트워크 ID 등을 공유합니다.
- 하나의 컨테이너만 들어있어도 되지만, 여러 컨테이너가 어떤 데이터를 밀접하게 공유해야한다면 하나의 파드에 넣어서 관리를 쉽게 합니다.

### 파드의 라이프 사이클
1. pending : 파드가 준비되고 있을때 나타납니다.
2. Running : 파드가 노드에 바인딩 되었고, 적어도 하나의 컨테이너가 실행  중일때 나타납니다.
3. Succeeded : 파드에 있는 모든 컨테이너가 성공적으로 종료되었을때 나타납니다.
4. Failed : 파드에서 적어도 하나 이상의 컨테이너가 실패로 종료되었을때 나타납니다.
5. Unkown : 알 수 없는 이유로 파드의 상태를 얻을 수 없을 때 나타납니다.

### 파드 생성
- 직접 개별 파드를 만드는 경우는 드물다. 파드를 만들고 관리해주는 <워크로드 리소스> 라는 것이 있기 떄문.

#### 워크로드 리소스
- 파드에 문제가 생겼을때 복제/롤아웃/자동복구를 실행
- 파드에 오류가 생겼을때 파드의 작동중지를 감지하고 대체 파드를 생성한 뒤, 대체 파드를 정상 노드에 배치하는 작업을 알잘딱 해줌.
- 워크로드 리소스는 아래와 같다.
```
1. 레플리카셋 
    - 여러 복제 파드의 실행을 항상 안정적으로 유지한다. 잘 쓰지 않고 레플리카셋을 포함하고 있는 디플로이먼트를 주로 사용한다.
2. 디플로이먼트
    - 파드와 레플리카셋에 대한 업데이트를 제공.
    - 디플로이먼트는 의도하는 상태를 명시하고 있고, 디플로이먼트 컨트롤러를 통해 현재 상태에서 의도하는 상태로 비율을 조정하며 변경.
    - 이 덕분에 여러 레플리카셋을 사용하면 서비스가 끊기지 않은 상태로 업데이트를 적용 가능.
3. 스테이트풀셋
    - 디플로이먼트와 유사하지만 파드들의 순서 및 고유성을 보장하며 각 파드의 독자성을 유지해줌.
4. 데몬 셋
    - 노드가 파드의 사본을 실행하도록함.
5. Job
    - 파드를 생성하고, 지정된 수의 파드가 성공적으로 종료될 때 까지 게속해서 파드의 실행을 재시도함.
```

### .yaml 파일 작성하기
- 쿠버네티스를 통해 파드를 생성할려면 yaml 파일을 작성해야함. (띄어쓰기 엄격하게 지켜야함)
- 아래와 같은 점을 꼭 명시해야함
```
apiVersion:
kind:
metadata:
spec:

1. apiVersion 
    - 쿠버네티스에서 사용할 api 버전을 의미
    - 서비스는 v1, 워크로드 리소스는 대부분 apps/v1 을 사용
2. kind
    - 무엇을 배포할지를 명시하는 부분
    - 디플로이먼트를 배포 = kind: Deployment 이런 식
3. metadata
    - 정보를 명시하는 부분
    - name 으로 디플로이먼트가 명명
    - 애플리케이션을 서비스하거나 래플리카셋을 만들때, 메타데이터 안의 라벨을 통해 서비스/복제할 대상을 구분
4. spec
    - 디플로이먼트를 어떻게 구성할 것인지에 대해 자세히 서술하는 부분.
    - 어떤 이미지를 가져오고 어떤 템플릿으로 레플리카셋을 만들 것인지 등을 명시
```

#### 예시 
- nginx 를 만든다고 가정
```yaml
apiVersion: apps/v1
kind: Deployment
metaData:
    name: nginx-deployment
    labels:
        app: nginx
spec:
    containers:
    - name: nginx
      image: nginx:1.14.2
      ports:
      - containerPort: 80
```
- 이렇게 하고 `kubectl apply -f nginx.yaml` 하면 실행됨

## 글을 마치며
- 다른것들은 책을 보면서 전체적인 흐름을 읽어야할 것 같음
- 1학기내로 docer, jeknis, kubernetes 등의 ops 툴에 익숙해져보자.