# VPC 네트워크에 대해 알아봅시다

## VPC보단 VPN 을 먼저 알아가자.
 VPN은 한국어로 "가상사설망" 으로 해석할 수 있습니다. "가상" 이라는 단어에서 알 수 있듯이 실제 사설망이 아닌 가상의 사설망입니다.

![v1](https://user-images.githubusercontent.com/82383294/136776100-e12c10a7-c3b1-4b7f-a060-28205583186b.png)<br>
한 건물의 네트워크가 위의 사진처럼 구성되어있는데 보안상 등의 이유로 직원간 네트워크를 분리하고 싶으면 건물의 인터넷 선공사며 내부선이며 다 뜯어 고쳐야하는데 이런 번거로움을 덜어내기 위해서 가상의 사설망인 `VPN`을 사용합니다.

![v2](https://user-images.githubusercontent.com/82383294/136776104-637f3693-b436-4026-9c2c-8bafbf55b3ea.png)<br>
AB가 있는 네트워크와 CD가 있는 네트워크는 실제로 같은 네트워크 상에 있지만 논리적으로는 다른 네트워크인것처럼 동작합니다. 이걸 우리는 `가상 사설망`이라 부르기로 약속했어요.

## VPC(Virtual Private Cloud)
>사용자가 정의하는 IP 주소 범위 선택, 서브넷 생성, 라우팅 테이블 및 네트워크 게이트웨이 구성 등 가상 네트워킹 환경을 VPC라고 합니다.

VPC가 없다면 EC2 인스턴스들이 거미줄 처럼 복잡하게 연결되고 인터넷과 연결돼요. 이런 구조는 하나만 추가돼도 처음부터 작업을 다시 하여야하기에 굉장히 불편해요.

VPC를 적용하면 VPC 별로 네트워크를 구성할 수 있고, 각각의 VPC에 따라 다르게 네트워크 설정을 줄 수 있어요. 또한 각각의 VPC는 완전히 독립된 네트워크처럼 작동해요.

## VPC의 구축 과정
 우선 VPC를 구축하기 위해선 VPC의 아이피범위를 RFC1918 이라는 사설 아이피 대역에 맞춰 구축해야해요.

 (사설 아이피 : 인터넷이 아닌 우리끼리 사용하는 아이피 주소)<br>
 ex) 우리 집 안방: 프라이빗(사설아이피), 우리집 주소 : 퍼블릭<br>
 
 ! 한번 설정된 아이피 대역은 수정 할 수 없고 각 VPC는 하나의 리전에 종속된다고해요! 만약 VPC간 통신을 원하시면 `VPC 피어링 서비스`를!

### VPC에서 사용하는 사설 아이피 대역
- 10.0.0.0 ~ 10.255.255.255(10/8 prefix)
- 172.16.0.0 ~ 172.31.255.255(182.16/12 prefix)
- 192.168.0.0 ~ 192.168.255.255(192.168/16 prefix)

## 서브넷
VPC를 만드셨으면 서브넷을 만드실 수 있는데요 서브넷은 VPC를 잘게 쪼개는거에요. 나누는 이유는 더 많은 네트워크 망을 만들기 위해서에요<br>

각각의 서브넷은 가용영역안에 존재하며 서브넷안에 `RDS`, `EC2`와같은 리소스들을 위치시킬 수 있어요.

## 라우팅 테이블과 라우터
네트워크 요청이 발생 == 데이터 -> 라우터
라우팅테이블은 각 목적지에 대한 이정표라고 할 수 있어요. VPC안의 네트워크 범위를 갖는 네트워크 요청은 로컬에서 찾도록 되어있지만 그 이외 외부로 통하는 트래픽을 처리할 수 없어요. 이때 인터넷 게이트웨이를 사용해요.

## 인터넷 게이트웨이
VPC와 인터넷을 연결해주는 하나의 관문이에요. 
인터넷과 연결되어있는 서브넷을 `퍼블릭서브넷`, 인터넷과연결되어있지않는 서브넷을 `프라이빗서브넷`이라고합니다.
## 네트워크 ACL과 보안그룹
방화벽과 같은 역할을 하며 인바운드 트래픽과 아웃바운드 트래픽 보안정책을 설정할 수 있어요 

보안그룹
- Stateful한 방식으로 동작하는 보안그룹은 모든 허용을 차단(기본 설정)
- 각각의 보안그룹별로도 별도의 트래픽을 설정 가능
- 서브넷에도 설정할 가능하지만 각각의 EC2에 적용하여야해요.

네트워크 ACL
- Stateless하게 작동해요.
- 모든 트래픽을 기본설정되어있기때문에 불필요한 트래픽을 막도록 적용해야해요.
- 서브넷단위로 적용되며 리소스별로는 설정할 수 없어요 
  
충돌 시 보안그룹 VS 네트워크 == `보안그룹이 더 높은 우선 순위를 가져요.`

## NAT 게이트웨이
프라이빗서브넷이 인터넷과 통신하기위한 아웃바운드 인스턴스에요. 
인바운드는 필요 없어도 가끔씩 아웃바운드 트래픽만 허용되야할 때가 있어요. 이때 NAT 게이트웨이는 외부로 요청하는 아웃바운드 트래픽을 받아 인터넷 게이트웨이와 연결 시켜요.

## VPC의 기능?
1. Reachability Analyzer<br>
    VPC내 두 개의 리소스 간 네트워크 도달가능성을 분석 및 디버깅 할 수 있는 정적 구성 분석도구에요.
2. VPC 플로 로그<br>
    s3 or CloudWatch 로 전달되는 VPC 플로 로그를 모니터링하여 네트워크 의존성, 트래픽 패턴에 대한 운영 가시성을 얻고, 추적하여 데이터 유출 예방, 연결성 및 구성 문제를 해결가능해요.
3. VPC 트래픽 미러링<br>
    EC2 인스턴스의 네트워크 인터페이스에서 네트워크 트래픽을 복사하고 그 트래픽을 대역 외 보안 및 모니터링 장치로 전송할 수 있게 허용해줘요.
4. 인그레스 라우팅<br>
    인터넷 게이트웨이(IGW) 또는 가상 프라이빗 게이트웨이(VGW)로, 그리고 여기에서 지정 EC2 인스턴스의 탄력적 네트워크 인터페이스로 모든 인바운드 및 아웃바운드 트래픽의 흐름을 라우팅할 수 있어요.
5. 보안 그룹 규칙<br>
    연결된 인스턴스에 대한 방화벽 역할을 하며 인스턴스 수준에서 인바운드 및 아웃바운드 트래픽을 모두 제어해요. 
6. NetWork Access Control List<br>
    VPC용 선택적 보안 레이어. 트래픽을 제어하는 방화벽 역할을 수행해요.




## 글을 마치며
어.. 요약하자면 VPC 는 가상 네트워킹 환경! 그리고 EC2에도 기본적으로 VPC가 사용되니까 공부를 해오라고 하신 것 같아요! 그냥 블로그 글 2개 보면서 리딩하고 조금씩 수정한 것 같아서 이게 맞나 싶기도 한데 이 내용으로 실습같은걸 하는게 아니라 기본 개념들을 정리한거라서 괜찮은 것 같기도하고..

## 참고
<a href = "https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098">[AWS]가장 쉽게 VPC 개념 잡기</a><br>
<a href = "https://dev.classmethod.jp/articles/for-beginner-vpc-explanation/">초보자도 이해할 수 있는 VPC</a>
