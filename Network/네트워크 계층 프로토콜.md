# 네트워크 계층 프로토콜

tcp/ip 에서 네트워크 계층 프로토콜은 ip,arp,icmp,igmp 로 구성된다.

## 주소 변환 프로토콜  _ ARP 와 RARP

### ARP란?

arp = Address Resolution Protocol

ip 주소를 물리적 주소(맥주소)로 변환시키는 프로토콜을 주소 결정 프로토콜(ARP)라고 함.

- Q : 왜 필요할까?
- A : 정확한 통신을 위해 맥주소가 필요함. 모르는 맥주소를 자동으로 등록 ㅇㅇ

### RARP란?

그 역과정을 주소 결정 프로토콜(RARP)라고 함.

### IP주소와 MAC주소 매핑 절차

a 호스트에서 c 호스트로 갔을때, 각 호스트에 ip 주소와 맥주소가 있을떄, ip 주소를 매핑하는것은 아래와 같다.

1. a 호스트 컴퓨터는 응용 프로그램이나 서비스를 이용하여 메시지를 작성하고 c 호스트컴퓨터의 ip 주소를 입력한다.
2. arp 는 c 호스트의 컴퓨터의 ip 주소에 해당하는 mac 주소를 알아내기 위해 arp 캐시에 해당하는 정보가 들어있는지 확인하고 정보가 있으면 메시지를 전송한다.
3. 해당 mac 주소가 없으면 모든 호스트 컴퓨터로 arp 요청 신호를 전송하며, 이때 요청 신호에 자신의 mac 주소와 수신지의 ip 주소를 포함한다.
4. arp 요청 신호를 모든 호스트 컴퓨터가 수신한다.
5. c 호스트 컴퓨터는 요청 신호의 ip 주소가 자신의 것이므로 자신의 mac 주소를 arp 응답신호로 a 호스트 컴퓨터에 전송한다.
6. 다른 호스트 컴퓨터는 요청한 주소에 해당하는 mac 주소를 알지 못하고, a 호스트 컴퓨터는 c 호스트 컴퓨터의 mac 주소를 자신의 arp 캐시에 저장한다.

### MAC 주소로 데이터 전송

??

### 응답 동작 과정

1. 캐시 테이블에 ip 주소와 맥주소의 조합을 저장 → 통신할때 효과적
2. 수명 설정 → 그 시간이 지나면 캐시 삭제
3. arp 요청은 lan 

### RARP

역주소 변환 프로토콜은 호스트 컴퓨터의 물리 주소를 알고 있을때 ip 주소를 알아내는데 사용한다 rarp 는 컴퓨터를 네트워크에 처음 연결할때나 디스크가 없는 컴퓨터를 부팅할때 사용하는 프로토콜로 이더넷 , 트큰링, FDDI등 근거리 통신망에서 사용할 수 있다.

# 메시지 프로토콜

## ICMP

- TCP/IP 에서 ip 패킷을 처리할때 무슨 문제가 있으면 알려주는 프로토콜이다.
- 네트워크상으로 연결이 돼 있는지, 만약 안 되어 있다면 어떤 이유로 안되어있는지를 알려주는 프로토콜
- 타입(8비트) , 코드(8비트), 체크sum(16비트) 로 이루어져있다.

## 메시지 종류

### 질의 : 네트워크의 상태를 요청하고 응답받는 메시지

- 에코 요청 및 응답 : 에코 리퀘스트와 에코 리플라이를 이용, ping 명령어에 사용
- 라우터 요청 및 응답 : 근처에 있는 라우터를 탐색하고 해당 라우터의 주소를 받을 수 있음.
- 타임 스탬프 요청 및 응답 : 두 시스템간에 왕복하는데 소요되는 시간
- 주소 마스크 요청 및 응답 : 서브넷 마스크를 얻는데 사용

### 오류 : 통신중 오류에 대한 메시지

- 목적지 도달 불가능 : 패킷이 중도 폐기될때 사용되는 메시지
- 시간초과 : 지정된 시간안에 패킷이 도착하지 않았을때 사용되는 메시지
- 매개변수 문제 : 파라미터에 문제가 생겼을때 사용되는 메시지
- 송신지 억제 : 통신량이 폭주하여 처리하기 힘들때 사용되는 메시지
- 재지정 : 호스트에게 패킷을 받은 라우터가 목적지로 가는 더 좋은 경로가 있음을 알려주는 메시지

## IGMP

- 머리캐스트를 사용할 때 필요한 그룹의 관리르 도와주는 프로토콜

### 동작 개요

- 멀티 케스트 라우터는 주기적으로 호스트 그룹들에게 IGMP Query 메세지를 전송한다. (특정 그룹에 참여하는 호스트가 있는지 확인)
- 호스트는 이러한 IGMP Query 메시지에 대한 응답으로 IGMP Report를 보내 알려줌( 특정 그룹에 참여하고자 하거나, 참여하고 있는지를 알림)
- * 호스트는 IGMP Query 메시지가 없이도, 먼저 IGMP Report를 보낼 수 있음 *

# 서브넷 마스크

넷 마스크 : 마스크란, 라우터가 네트워크를 식별하기 위한 비트, 010.003.004.003

### 네트워크 주소와 브로드 캐스트 주소

컴퓨터에 할당할 수 없는 특별한 Ip인 네트워크 주소와 브로드캐스트 주소에 대해 알아보자. 네트워크 주소와 브로드캐스트 주소는 컴퓨터나 라우터가 자신의 ip 로 사용할 수 없는 주소.

네트워크 주소는 호스트 Id 가 2진수로 00000000이고 10진수로 0인주소

브로드캐스트 주소는 호스트 id 가 2진수로 11111111 이고 10진수로 255인 주소이다.

### 서브넷?

a 클래스의 대규모 네트워크를 좀 더 작은 네트워크크로 분할하여 브로드캐스트로 전송되는 패킷의 범위를 좁힐 수 있는데, 네트엌르르 분할하는 것을 서브넷팅이라고하고 분할된 네트워크를 서브넷이라고한다.

하는 이유 : 이렇게 하면 더 많은 네트워크를 생성함으로써 ip 주소를 보다 효율적으로 활용할 수 있기 떄문.
